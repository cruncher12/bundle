<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>About - Bundle</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
</head>
<body>
  <div class="navbar"></div>
  <div class="content">
    <div id="code" contenteditable="" spellcheck="false">
      start
      <br>
ask what's your name?<br>
write hello there, <br>
throw ans<br>
write !<br>
break<br>
you've got a nice name :)
      <br>
      end
    </div><br><button onclick="runbundle($('#code')[0].innerText)">Run!</button><br><br><b>Output:</b><br><code id="output" style="whitespace:pre"></code>
  </div>
  <script>
    function runbundle(algorithm) {
    $("#output")[0].innerText = "";
    let commands = ["start", "end", "debug"];
    let variables = {
      "null": "null"
    };
    let disableDebug = true;
    
    algorithm = algorithm.split("\n"); // .slice(1, -1)
    
    if (algorithm[0] != "start") {
        throwErr("bad start");
    }else{
        if (algorithm[algorithm.length-1] != "end") {
            throwErr("bad end");
        }else{
            algorithm.slice(1, -1)
            for (let i = 0;i < algorithm.length;i++) {
                if (commands.includes(algorithm[i])) {
                  if (algorithm[i] == "debug") {
                    disableDebug = false;
                  }
                }else{
                    if (algorithm[i].startsWith("write ")) {
                        message(algorithm[i].slice(6));
                          debug("Wrote", disableDebug);
                          debug("", disableDebug);
                    }else{
                      if (algorithm[i].startsWith("ask ")) {
                          variables.ans = prompt(algorithm[i].slice(4));
                          // message("[" + (i+1).toString() + "] " + variables.ans);
                          debug("Asked: " + algorithm[i].slice(4), disableDebug);
                          debug("sent request to set \"ans\" as response", disableDebug);
                          debug("ans: " + variables.ans, disableDebug);
                          debug("", disableDebug);
                      }else{
                        if (algorithm[i].startsWith("def ")) {
                            if (algorithm[i].split("=").length != 2) {
                              debug("failed to create variable, incorrect number of arguments!", disableDebug);
                              debug("", disableDebug);
                              throwErr("bad command");
                            }else{
                              debug("created variable", disableDebug);
                              debug("name: " + algorithm[i].split("=")[0].slice(4), disableDebug);
                              debug("value: " + algorithm[i].split("=")[1], disableDebug);
                              debug("", disableDebug);
                              variables[algorithm[i].split("&")[0].slice(4)] = algorithm[i].split("&")[1];
                            }
                        }else{
                          if (algorithm[i].startsWith("throw ")) {
                            if (variables[algorithm[i].slice(6)] == null) {
                              throwErr("bad variable")
                              debug("Failed to throw variable since it doesn't exist", disableDebug);
                              debug("", disableDebug);
                            }else{
                              message(variables[algorithm[i].slice(6)]);
                              debug("Threw variable", disableDebug);
                              debug("", disableDebug);
                            }
                          }else{
                            if (algorithm[i] == "break") {
                              message("\n");
                            }else{
                                throwErr("bad command");
                                break;
                            }
                          }
                        }
                      }
                    }
                }
            }
          if (algorithm.length == 0) {
            throwErr("bad commands list");
          }
        }
    }
    }
    
    function throwErr(x) {
      $("#output")[0].innerText = $("#output")[0].innerText + "\n" + x;
    }
    
    function message(x) {
      $("#output")[0].innerText = $("#output")[0].innerText + x;
    }
    
    function debug(x, y) {
      if (y == true) return;
      $("#output")[0].innerText = $("#output")[0].innerText + "\n[debug] " + x;
    }
  </script>
</body>
</html>